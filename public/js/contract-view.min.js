var POSITIONS={above:"above",inside:"inside",below:"below"},Waypoint=React.createClass({displayName:"Waypoint",propTypes:{onEnter:React.PropTypes.func,onLeave:React.PropTypes.func,threshold:React.PropTypes.number},getDefaultProps:function(){return{threshold:0,onEnter:function(){},onLeave:function(){}}},componentDidMount:function(){this.scrollableAncestor=this._findScrollableAncestor(),this.scrollableAncestor.addEventListener("scroll",this._handleScroll),window.addEventListener("resize",this._handleScroll),this._handleScroll()},componentDidUpdate:function(){this._handleScroll()},componentWillUnmount:function(){this.scrollableAncestor&&this.scrollableAncestor.removeEventListener("scroll",this._handleScroll),window.removeEventListener("resize",this._handleScroll)},_findScrollableAncestor:function(){for(var t=React.findDOMNode(this);t.parentNode;)if(t=t.parentNode,t!==document){var e=window.getComputedStyle(t),a=e.getPropertyValue("overflow-y")||e.getPropertyValue("overflow");if("auto"===a||"scroll"===a)return t}return window},_handleScroll:function(t){var e=this._currentPosition();if(this._previousPosition!==e){e===POSITIONS.inside?this.props.onEnter.call(this,t):this._previousPosition===POSITIONS.inside&&this.props.onLeave.call(this,{event:t,position:e});var a=this._previousPosition===POSITIONS.below&&e===POSITIONS.above,n=this._previousPosition===POSITIONS.above&&e===POSITIONS.below;(a||n)&&(this.props.onEnter.call(this,t),this.props.onLeave.call(this,{event:t,position:e})),this._previousPosition=e}},_distanceToTopOfScrollableAncestor:function(t){return this.scrollableAncestor!==window&&!t.offsetParent,t.offsetParent!==this.scrollableAncestor&&t.offsetParent?t.offsetTop+this._distanceToTopOfScrollableAncestor(t.offsetParent):t.offsetTop},_currentPosition:function(){var t,e,a=this._distanceToTopOfScrollableAncestor(React.findDOMNode(this));this.scrollableAncestor===window?(t=window.innerHeight,e=window.pageYOffset):(t=this.scrollableAncestor.offsetHeight,e=this.scrollableAncestor.scrollTop);var n=t*this.props.threshold,o=a+n>=e;if(!o)return POSITIONS.above;var s=e+t,r=s>=a-n;return r?POSITIONS.inside:POSITIONS.below},render:function(){return React.createElement("span",{style:{fontSize:0}})}}),Pdf=React.createClass({displayName:"React-PDF",propTypes:{file:React.PropTypes.string,content:React.PropTypes.string,page:React.PropTypes.number,scale:React.PropTypes.number,onDocumentComplete:React.PropTypes.func,onPageComplete:React.PropTypes.func},getInitialState:function(){return{message:""}},loadFile:function(){var t=this.props.pdfPage.get("content");"-1"!==t&&t?"-"!==t?(debug("react.pdf.js loadFile: getDocument content called"),this.setState({message:"",content:t}),PDFJS.getDocument(t).then(this._onDocumentComplete)):this.setState({page:"",message:"",content:""}):this.setState({page:"",content:"",message:React.createElement("div",{className:"no-contract-error"},lang.sorry_loading,"  ",React.createElement("a",{href:"mailto: +{email} "},email)," ",lang.to_let_us_know)})},componentDidMount:function(){var t=this;this.props.pdfPage.on("change:content",function(){debug("react.pdf.js pdfPage change:content called"),t.loadFile()}),this.props.contractApp.on("change:pdfscale",function(){debug("react.pdf.js pdfPage change:pdfscale called"),t.forceUpdate()})},render:function(){var t=this;if(this.state.page)return setTimeout(function(){if(t.isMounted()){var e=t.refs.pdfCanvas.getDOMNode(),a=e.getContext("2d"),n=t.props.scale,o=t.state.page.getViewport(1);o.width>600&&1===n?n=595/o.width:o.width>600&&(n=595*n/o.width),o=t.state.page.getViewport(n),e.width=o.width,e.height=o.height;var s={canvasContext:a,viewport:o},r=t.state.page.render(s),i=r._internalRenderTask.callback;r._internalRenderTask.callback=function(e){debug("react.pdf pageRendering callback",e),i.call(this,e),t.props.onPageRendered&&"function"==typeof t.props.onPageRendered&&t.state.content&&t.props.onPageRendered()}}}),React.createElement("canvas",{ref:"pdfCanvas"});if(this.state.message)return debug("react.pdf  showing generic message",this.state.message),React.createElement("div",null,this.state.message);var e=this.props.contractApp.getCurrentPage();return debug("react.pdf showing page loader",e),this.props.loading||React.createElement("div",null,lang.loading_page+e)},_onDocumentComplete:function(t){this.props.onDocumentComplete&&"function"==typeof this.props.onDocumentComplete&&this.props.onDocumentComplete(t.numPages),t.getPage(parseInt(this.props.page)).then(this._onPageComplete)},_onPageComplete:function(t){this.setState({page:t}),this.props.onPageComplete&&"function"==typeof this.props.onPageComplete&&this.props.onPageComplete(t.pageIndex+1)}}),PdfPaginationView=React.createClass({displayName:"PdfPaginationView",getInitialState:function(){return{visiblePage:1,totalPages:0}},changePage:function(t){this.refs.userInput.getDOMNode().value=t,this.setState({visiblePage:t}),this.props.contractApp.setCurrentPage(t)},clickPrevious:function(t){t.preventDefault(),this.state.visiblePage>1&&this.changePage(this.state.visiblePage-1)},clickNext:function(t){t.preventDefault(),this.state.visiblePage<this.state.totalPages&&this.changePage(this.state.visiblePage+1)},handleKeyDown:function(t){if(13==t.keyCode){var e=parseInt(this.refs.userInput.getDOMNode().value);e>0&&e<=this.state.totalPages?this.changePage(e):this.changePage(this.state.visiblePage)}},componentDidMount:function(){var t=this;t.setState({totalPages:t.props.contractApp.getTotalPages()}),this.props.contractApp.on("update-pdf-pagination-page",function(e){t.refs.userInput.getDOMNode().value=e,t.setState({visiblePage:e})}),this.refs.userInput.getDOMNode().value=this.state.visiblePage},render:function(){return React.createElement("div",{className:"pdf-pagination pagination",style:this.props.style},React.createElement("a",{href:"#",className:"previous",onClick:this.clickPrevious},lang.previous),React.createElement("input",{type:"text",className:"goto",ref:"userInput",onKeyDown:this.handleKeyDown}),React.createElement("a",{href:"#",className:"next",onClick:this.clickNext},lang.next)," ",lang.of," ",this.state.totalPages)}}),PdfZoom=React.createClass({displayName:"PdfZoom",getInitialState:function(){return{scale:"1"}},handleClick:function(t){var e=event.target.innerHTML;this.setState({scale:e.replace(".","")}),this.props.contractApp.setPdfScale(t.target.innerHTML)},render:function(){var t="scale-"+this.state.scale;return $(".pdf-zoom-options span").removeClass("scale-selected"),$(".pdf-zoom-options ."+t).addClass("scale-selected"),React.createElement("div",{className:"pdf-zoom-options",style:this.props.style}," Zoom",React.createElement("div",null,React.createElement("span",{onClick:this.handleClick,className:"scale-1 scale-selected"},"1"),React.createElement("span",{onClick:this.handleClick,className:"scale-125"},"1.25"),React.createElement("span",{onClick:this.handleClick,className:"scale-15"},"1.5")))}}),PdfViewer=React.createClass({displayName:"PdfViewer",getInitialState:function(){return{loadAnnotations:!1}},componentDidMount:function(){this.loadAnnotationsFlag=!1;var t=this;this.props.pagesCollection.on("reset",function(){debug("pdf.view.js pagesCollection reset called: triggering change:page_no"),t.props.contractApp.trigger("change:page_no")}),this.props.contractApp.on("change:pdfscale",function(){t.loadAnnotationsFlag=!0,t.forceUpdate()}),this.props.pdfPage.on("change:content",function(){t.loadAnnotationsFlag=!0})},render:function(){this.props.contractApp.getCurrentPage(),this.props.contractApp.getPdfUrl();return React.createElement("div",{className:"pdf-viewer pdf-annotator",style:this.props.style},React.createElement(Pdf,{contractApp:this.props.contractApp,pdfPage:this.props.pdfPage,page:1,content:this.props.pdfPage.get("content"),scale:parseFloat(this.props.contractApp.getPdfScale())||1,onPageRendered:this._onPageRendered,renderReady:this.state.renderReady}))},loadAnnotations:function(){this.annotator||(this.annotator=new PdfAnnotatorjsView({el:".pdf-annotator",api:this.props.contractApp.getLoadAnnotationsUrl(),availableTags:["Country","Local-Company-Name"],annotationCategories:["General information","Country","Local company name"],enablePdfAnnotation:!0,contractApp:this.props.contractApp}))},_onPageRendered:function(){"pdf"===this.props.contractApp.getView()&&this.loadAnnotationsFlag&&(this.annotator?(this.annotator.pageUpdated(),this.loadAnnotationsFlag=!1):$(".pdf-viewer").is(":visible")&&(this.loadAnnotations(),this.loadAnnotationsFlag=!1))}}),MetadataToggleButton=React.createClass({displayName:"MetadataToggleButton",getInitialState:function(){return{showMeta:!0}},handleClick:function(){this.state.showMeta?(this.setState({showMeta:!1}),$(".right-column-view").hide(),$(".metadata-toggle-button").removeClass("metadata-shown"),$(".pdf-viewer").css("width","70%"),$(".text-panel").css("width","70%")):(this.setState({showMeta:!0}),$(".metadata-toggle-button").addClass("metadata-shown"),$(".right-column-view").show(),$(".pdf-viewer").css("width","50%"),$(".text-panel").css("width","50%"))},render:function(){return React.createElement("div",{className:"metadata-toggle-button pull-right metadata-shown"},React.createElement("span",{onClick:this.handleClick},"Meta"))}}),MetadataView=React.createClass({displayName:"MetadataView",getInitialState:function(){return{showMoreMetadata:!1}},componentDidMount:function(){var t=this;this.props.metadata.on("sync",function(){t.forceUpdate()})},clickShowMoreMetadata:function(t){t.preventDefault(),this.setState({showMoreMetadata:!this.state.showMoreMetadata}),this.state.showMoreMetadata?$(".metadata-view .show-more-meta").hide(500):$(".metadata-view .show-more-meta").show(500)},render:function(){var t=lang.show_more;if(this.state.showMoreMetadata&&(t=lang.show_less),this.props.metadata.get("country")){var e=this.props.metadata.get("country").code.toLowerCase(),a=app_url+"/countries/"+e,n=this.props.metadata.get("signature_year"),o=app_url+"/contracts?year="+n,s=this.props.metadata.get("type_of_contract"),r=s.map(function(t,e){return e!=s.length-1?React.createElement("a",{href:app_url+"/search?q=&contract_type%5B%5D="+t,key:e},t+" | "):React.createElement("a",{href:app_url+"/search?q=&contract_type%5B%5D="+t,key:e},t)}),i=(new RegExp(" ","g"),app_url+"/resources/",this.props.metadata.get("resource").length),c=this.props.metadata.get("resource").map(function(t,e){return e!=i-1?React.createElement("a",{href:app_url+"/resource/"+t,key:e},t+" | "):React.createElement("a",{href:app_url+"/resource/"+t,key:e},t)});if(""!=this.props.metadata.get("contract_note"))var l=React.createElement("div",{className:"metadata-info"},React.createElement("span",null,"Note"),React.createElement("p",null,this.props.metadata.get("contract_note")));return React.createElement("div",null,l,React.createElement("div",{className:"metadata-view"},React.createElement("div",null,lang.metadata,React.createElement("div",{className:"metadata-view-footer pull-right"},React.createElement("a",{href:this.props.contractApp.getMetadataSummaryLink()},lang.see_summary))),React.createElement("div",{className:"metadata-country"},React.createElement("span",null,lang.country),React.createElement("span",null,React.createElement("a",{href:a},this.props.metadata.get("country").name))),React.createElement("div",{className:"metadata-signature-year"},React.createElement("span",null,lang.signature_year),React.createElement("span",null,React.createElement("a",{href:o},this.props.metadata.get("signature_year")||"-"))),React.createElement("div",{className:"metadata-resource"},React.createElement("span",null,lang.resource),React.createElement("span",null,c)),React.createElement("div",{className:"metadata-type-contract"},React.createElement("span",null,lang.type_contract),React.createElement("span",null,r)),React.createElement("div",{className:"metadata-ocid"},React.createElement("span",null,lang.open_contracting_id),React.createElement("span",null,this.props.metadata.get("open_contracting_id"))),React.createElement("div",{className:"metadata-ocid"},React.createElement("span",null,lang.disclosure_mode),React.createElement("span",null,this.props.metadata.get("disclosure_mode")||"-")),React.createElement(LandMatrixView,{metadata:this.props.metadata})))}return React.createElement("div",{className:"metadata-view"},React.createElement("div",null,lang.metadata),React.createElement("span",null,lang.loading),React.createElement("div",{className:"metadata-view-footer"},React.createElement("a",{href:this.props.contractApp.getMetadataSummaryLink()},lang.see_summary)))}}),LandMatrixView=React.createClass({displayName:"LandMatrixView",componentDidMount:function(){var t=this;this.props.metadata.on("sync",function(){t.forceUpdate()})},render:function(){var t="-";return this.props.metadata.get("deal_number")&&(t="#"+this.props.metadata.get("deal_number")),"olc"===this.props.metadata.get("category")[0]?React.createElement("div",{className:"metadata-ocid"},React.createElement("span",null,"Land Matrix ID: "),React.createElement("a",{target:"_blank",href:this.props.metadata.get("matrix_page")},t)):React.createElement("div",null)}}),RelatedDocumentsView=React.createClass({displayName:"RelatedDocumentsView",componentDidMount:function(){var t=this;this.props.metadata.on("sync",function(){t.forceUpdate()})},render:function(){function t(t){var e=(t+"").split(" "),a="";return e.length>10&&(a=" ..."),e=e.splice(0,10),e.join(" ")+a}var e="",a=[],n="";if(this.props.metadata.get("parent_document")){e=this.props.metadata.get("parent_document").map(function(t){var e=app_url+"/contract/"+t.open_contracting_id;return"published"===t.status?React.createElement("span",null,React.createElement("a",{href:e},t.contract_name)):void 0});for(var o=3,s=this.props.metadata.get("supporting_contracts").length<o?this.props.metadata.get("supporting_contracts").length:o,r=0;s>r;r++){var i=this.props.metadata.get("supporting_contracts")[r];if("published"===i.status){var c=app_url+"/contract/"+i.id;a.push(React.createElement("span",{id:r},React.createElement("a",{href:c},t(i.contract_name))))}}return this.props.metadata.get("supporting_contracts").length>o&&(n=React.createElement("span",null,React.createElement("a",{href:this.props.contractApp.getMetadataSummaryLink()+"#relateddocs"},lang.all_related))),e.length||a.length?React.createElement("div",{className:"relateddocument-view"},React.createElement("div",null,lang.related_docs),e,a,n):React.createElement("div",null)}return React.createElement("div",{className:"relateddocument-view"},React.createElement("div",null,lang.related_docs),lang.loading)}}),RelatedDocumentsMoreView=React.createClass({displayName:"RelatedDocumentsMoreView",componentDidMount:function(){var t=this;this.props.metadata.on("sync",function(){t.forceUpdate()})},render:function(){if(this.props.metadata.get("country")){var t=this.props.metadata.get("country").code.toLowerCase(),e=app_url+"/countries/"+t,a=React.createElement("a",{href:e},this.props.metadata.get("country").name),n=(app_url+"/resources/",this.props.metadata.get("resource").map(function(t,e){return React.createElement("a",{href:app_url+"/resource/"+t,key:e},t)}));return React.createElement("div",{className:"relateddocument-more-view"},React.createElement("div",null,"More"),React.createElement("div",null,React.createElement("div",null,"From ",a),React.createElement("div",null,"For ",n)))}return React.createElement("div",{className:"relateddocument-more-view"},React.createElement("div",null,"More"),React.createElement("span",null,"Loading..."))}}),OtherSourcesView=React.createClass({displayName:"OtherSourcesView",componentDidMount:function(){var t=this;this.props.metadata.on("sync",function(){t.forceUpdate()})},render:function(){if(this.props.metadata.get("company")){var t=this.props.metadata.get("amla_url"),e=React.createElement("span",null,React.createElement("a",{href:t},this.props.metadata.get("country").name),"Legislation");return t?React.createElement("div",{className:"other-sources-view"},React.createElement("div",null,lang.other_sources),React.createElement("div",null,React.createElement("div",null,e))):React.createElement("div",null)}return React.createElement("div",{className:"other-sources-view"},React.createElement("div",null,lang.other_sources),React.createElement("span",null,lang.loading))}}),RightColumnView=React.createClass({displayName:"RightColumnView",render:function(){return React.createElement("div",{className:"right-column-view"},React.createElement(MetadataView,{contractApp:this.props.contractApp,metadata:this.props.metadata}),React.createElement(RelatedDocumentsView,{metadata:this.props.metadata}))}}),NavigationView=React.createClass({displayName:"NavigationView",render:function(){return"pdf"===this.props.contractApp.getView()?(pdfClass="active",textClass=""):(textClass="active",pdfClass=""),React.createElement("div",{className:"navigation"},React.createElement("a",{href:"#/text",className:textClass},lang.text),React.createElement("a",{href:"#/pdf",className:pdfClass},lang.pdf))}}),TextPaginationView=React.createClass({displayName:"TextPaginationView",getInitialState:function(){return{visiblePage:1,totalPages:0}},changePage:function(t){this.refs.userInputText.getDOMNode().value=t,this.props.contractApp.setCurrentPage(t),this.setState({visiblePage:t}),this.props.contractApp.triggerScrollToTextPage()},clickPrevious:function(t){t.preventDefault(),this.state.visiblePage>1&&this.changePage(this.state.visiblePage-1)},clickNext:function(t){t.preventDefault(),this.state.visiblePage<this.state.totalPages&&this.changePage(this.state.visiblePage+1)},handleKeyDown:function(t){if(13==t.keyCode){var e=parseInt(this.refs.userInputText.getDOMNode().value);e>0&&e<=this.state.totalPages?this.changePage(e):this.changePage(this.state.visiblePage)}},componentDidMount:function(){var t=this;t.setState({totalPages:t.props.contractApp.getTotalPages()}),this.props.contractApp.on("update-text-pagination-page",function(e){t.refs.userInputText.getDOMNode().value=e,t.setState({visiblePage:e})}),this.refs.userInputText.getDOMNode().value=this.state.visiblePage},render:function(){return React.createElement("div",{className:"text-pagination pagination",style:this.props.style},React.createElement("a",{href:"#",className:"previous",onClick:this.clickPrevious},lang.previous),React.createElement("input",{type:"text",className:"goto",ref:"userInputText",onKeyDown:this.handleKeyDown}),React.createElement("a",{href:"#",className:"next",onClick:this.clickNext},lang.next),lang.of," ",this.state.totalPages)}}),TextPageView=React.createClass({displayName:"TextPageView",getInitialState:function(){return{originalHtml:"",searchresultsHtml:""}},_onEnter:function(t,e){this.props.contractApp.triggerUpdateTextPaginationPage(this.props.page.get("page_no"))},_onLeave:function(t){},sanitizeTxt:function(t){return t=t.replace(/(<)(\/?)(?=span|div|br)([^>]*)(>)/g,"----lt----$2$3----gt----"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/----lt----/g,"<"),t=t.replace(/----gt----/g,">")},highlightSearchQuery:function(t,e){e=decodeURI(e);var a=new RegExp("("+e+")","gi");return t.replace(a,"<span class='search-highlight-word'>$1</span>")},componentDidMount:function(){var t=this;this.props.contractApp.on("searchresults:close",function(){t.setState({searchresultsHtml:""})}),this.props.contractApp.on("searchresults:ready",function(){if(t.props.contractApp.getSearchQuery()){var e=t.sanitizeTxt(t.props.page.get("text")),a=t.highlightSearchQuery(e,t.props.contractApp.getSearchQuery());t.state.originalHtml?t.setState({searchresultsHtml:a}):t.setState({originalHtml:e,searchresultsHtml:a})}})},render:function(){var t="";t=this.state.originalHtml?this.state.searchresultsHtml?this.state.searchresultsHtml:this.state.originalHtml:this.sanitizeTxt(this.props.page.get("text"));var e=this.props.page.get("page_no");return React.createElement("span",{className:e},React.createElement("span",null,e),React.createElement("span",{ref:"text_content",dangerouslySetInnerHTML:{__html:t}}),React.createElement(Waypoint,{onEnter:this._onEnter.bind(this,"enter"+e),onLeave:this._onLeave,threshold:-.4}))}}),TextViewer=React.createClass({displayName:"TextViewer",getInitialState:function(){return{}},handleClickWarning:function(t){t.preventDefault(),$(t.target).parent().hide(500)},loadAnnotations:function(){this.annotator||(this.annotator=new AnnotatorjsView({el:".text-annotator",api:this.props.contractApp.getLoadAnnotationsUrl(),availableTags:["Country","Local-Company-Name"],annotationCategories:["General information","Country","Local company name"],enablePdfAnnotation:!1,contractApp:this.props.contractApp}))},scrollToPage:function(t){if($("."+t).offset()){var e=$("."+t).offset().top,a=$(".text-annotator ").scrollTop(),n=$(".text-annotator").offset().top;$(".text-annotator").animate({scrollTop:a-n+e},100)}},componentDidMount:function(){var t=this;this.props.contractApp.on("searchresults:ready",function(){t.annotator&&setTimeout(t.annotator.reload(),1e3)}),this.props.contractApp.on("searchresults:close",function(){t.annotator&&setTimeout(t.annotator.reload(),1e3)}),this.props.pagesCollection.on("reset",function(){t.message="",0===t.props.pagesCollection.models.length&&(t.message=React.createElement("div",{"class":"no-contract-error"},lang.sorry_loading)),t.forceUpdate(),t.loadAnnotations(),t.props.contractApp.triggerScrollToTextPage()}),this.props.contractApp.on("scroll-to-text-page",function(){t.scrollToPage(t.props.contractApp.getCurrentPage())})},render:function(){var t=this,e=this.props.metadata.get("show_pdf_text"),a=this.message?"":React.createElement("div",{className:"text-viewer-warning"},React.createElement("span",{className:"pull-right link close",onClick:this.handleClickWarning},"x"),lang.text_created_automatically,React.createElement("a",{target:"_blank",href:app_url+"/faqs"},"Learn more")),n=this.message?this.message:lang.wait_while_loading;if(this.props.pagesCollection.models.length>0){n=[];for(var o=0;o<this.props.pagesCollection.models.length;o++){var s=this.props.pagesCollection.models[o];n.push(React.createElement(TextPageView,{key:o,contractApp:t.props.contractApp,page:s}))}}return"undefined"==typeof e&&(a=""),0==e&&(a=React.createElement("div",{className:"text-viewer-warning"},lang.processing_pdf_file),n=""),React.createElement("div",{className:"text-panel",style:this.props.style},a,React.createElement("div",{className:"text-annotator"},React.createElement("div",null),React.createElement("div",{className:"text-viewer"},n)))}}),TextSearchForm=React.createClass({displayName:"TextSearchForm",handleSubmit:function(t){t.preventDefault();var e=React.findDOMNode(this.refs.searchInput).value.trim();e&&(document.location.hash="#/search/"+encodeURI(e))},render:function(){return React.createElement("div",{className:"text-search-container"},React.createElement("a",{className:"back",href:back_url},"Back"),React.createElement("div",{className:"text-search"},React.createElement("form",{onSubmit:this.handleSubmit},React.createElement("input",{type:"text",className:"",ref:"searchInput",placeholder:lang.search_in_this_document}))))}}),TextSearchResultRow=React.createClass({displayName:"TextSearchResultRow",handleClick:function(){this.props.contractApp.setCurrentPage(this.props.resultRow.get("page_no")),this.props.contractApp.triggerScrollToTextPage()},highlightSearchQuery:function(t,e){e=decodeURI(e);var a=new RegExp(e,"gi");return t.replace(a,"<span class='search-highlight-word'>"+e+"</span>")},render:function(){var t=this.highlightSearchQuery(this.props.resultRow.get("text"),this.props.contractApp.getSearchQuery());return t="Pg "+this.props.resultRow.get("page_no")+"&nbsp;"+t,React.createElement("div",{className:"search-result-row link",onClick:this.handleClick},React.createElement("span",{dangerouslySetInnerHTML:{__html:t}}))}}),TextSearchResultsList=React.createClass({displayName:"TextSearchResultsList",componentDidMount:function(){var t=this;this.props.searchResultsCollection.on("reset",function(){t.forceUpdate(),t.props.contractApp.trigger("searchresults:ready")})},handleCloseSearchResults:function(){this.props.contractApp.trigger("searchresults:close"),document.location.hash="#/text",this.props.contractApp.setView("text")},render:function(){var t=this,e=lang.searching;return this.props.searchResultsCollection.models.length>0?e=this.props.searchResultsCollection.models.map(function(e,a){return React.createElement(TextSearchResultRow,{key:a,contractApp:t.props.contractApp,resultRow:e})}):(this.props.searchResultsCollection.searchCompleted===!0||0==this.props.searchResultsCollection.length)&&(e=lang.no_results_found),React.createElement("div",{style:this.props.style,className:"search-results-list"},React.createElement("span",{className:"pull-right link close",onClick:this.handleCloseSearchResults},"x"),e)}}),AnnotationHeader=React.createClass({displayName:"AnnotationHeader",componentDidMount:function(){var t=this;this.props.annotationsCollection.on("reset",function(){t.forceUpdate()})},render:function(){var t=this.props.annotationsCollection.length;return 0==t?React.createElement("div",{className:"annotation-title"},t," ",lang.annotations," "):React.createElement("div",{className:"annotation-title"},t," ",lang.annotations,React.createElement("span",{className:"pull-right"},React.createElement("a",{href:this.props.contractApp.getAnnotationsListAnchor()},lang.see_all)))}}),AnnotationItem=React.createClass({displayName:"AnnotationItem",getInitialState:function(){return{maxWords:10,showEllipse:!1,showMoreFlag:!1,annotationType:"",text:""}},componentDidMount:function(){function t(t){var e=(t.get("text")||"")+"",a=(t.get("quote")||"")+"";return e&&a?e.trim()+" - "+a.trim():e&&e.trim()?e.trim():a&&a.trim()?a.trim():""}function e(t){var e=(t+"").split(" ");return e.length>n.state.maxWords?!0:!1}function a(t){var e=(t+"").split(" ");return e=e.splice(0,n.state.maxWords),e.join(" ")}var n=this,o=this.props.annotation.get("cluster")?this.props.annotation.get("cluster"):"Other",s=this.props.annotation.get("category"),r=s.split("//")[0],i=s.split("//")[1],c=this.props.annotation.get("id"),l=t(this.props.annotation),p=l.split("--")[1]||"";l=l.split("--")[0];var h=e(l),d=this.props.annotation.get("page_no"),m="";h&&(m=a(l));var g="text";this.props.annotation.get("shapes")&&(g="pdf");var u=this.props.contractApp.getSelectedAnnotation()===c?!0:!1,f=this.props.contractApp.getSelectedAnnotation()===c?!0:!1;this.setState({id:c,text:l,preamble:p,cluster:o,shortText:m,categoryEn:r,categoryFr:i,pageNo:d,annotationType:g,showEllipse:h,highlight:u,showMoreFlag:f}),this.props.contractApp.on("annotations:highlight",function(t){t.id===n.state.id?(n.setState({showMoreFlag:!0,highlight:!0}),location.hash="#/pdf/page/"+n.state.pageNo+"/annotation/"+n.state.id):n.setState({showMoreFlag:!1,highlight:!1})}),this.props.contractApp.on("change:selected_annotation_id-1",function(){n.props.contractApp.getSelectedAnnotation()===n.state.id?(n.setState({showMoreFlag:!0,highlight:!0}),location.hash="#/pdf/page/"+n.state.pageNo+"/annotation/"+n.state.id):n.setState({showMoreFlag:!1,highlight:!1})})},handleAnnotationClick:function(t){var e=this;switch(t.preventDefault(),this.state.annotationType){case"pdf":this.props.contractApp.setView("pdf"),location.hash="#/pdf/page/"+e.state.pageNo+"/annotation/"+e.state.id,this.props.contractApp.setSelectedAnnotation(e.state.id),this.props.contractApp.trigger("annotations:highlight",{id:e.state.id}),this.props.contractApp.setCurrentPage(e.state.pageNo),this.props.contractApp.triggerUpdatePdfPaginationPage(e.state.pageNo);break;case"text":location.hash="#/text/page/"+e.state.pageNo+"/annotation/"+e.state.id,this.props.contractApp.trigger("annotations:highlight",{id:e.state.id}),this.props.contractApp.setView("text"),this.props.contractApp.setCurrentPage(e.state.pageNo),setTimeout(this.props.contractApp.triggerScrollToTextPage())}},handleEllipsis:function(t){t.preventDefault();t.target.innerHTML;this.setState({showMoreFlag:!this.state.showMoreFlag})},render:function(){var t=this.state.highlight?"annotation-item selected-annotation":"annotation-item",e="",a=this.state.text;return this.state.showEllipse&&(a=this.state.text,e=lang.less,this.state.showMoreFlag||(e=lang.more,a=this.state.shortText)),void 0===this.props.prevAnnotation||this.props.showClusterAnyway?React.createElement("div",{className:t,id:this.state.id},React.createElement("span",{className:"header annotation-cluster"},this.state.cluster),React.createElement("span",{className:"link annotation-category-en"},React.createElement("a",{href:"#",onClick:this.handleAnnotationClick},this.state.categoryEn)),React.createElement("span",{className:"link annotation-category-fr",onClick:this.handleAnnotationClick},this.state.categoryFr),React.createElement("span",{className:"annotation-item-content"},a,React.createElement("nobr",null,React.createElement("a",{className:"annotation-item-ellipsis",href:"#",onClick:this.handleEllipsis,dangerouslySetInnerHTML:{__html:e}}))),React.createElement("span",{className:"annotation-item-preamble"},this.state.preamble),React.createElement("span",{className:"link annotation-item-page",onClick:this.handleAnnotationClick},"Page ",this.state.pageNo)):this.props.annotation.attributes.category_key!==this.props.prevAnnotation.attributes.category_key?React.createElement("div",{className:t,id:this.state.id},React.createElement("span",{className:"link annotation-category-en"},React.createElement("a",{href:"#",onClick:this.handleAnnotationClick},this.state.categoryEn)),React.createElement("span",{className:"link annotation-category-fr",onClick:this.handleAnnotationClick},this.state.categoryFr),React.createElement("span",{className:"annotation-item-content"},a,React.createElement("nobr",null,React.createElement("a",{className:"annotation-item-ellipsis",href:"#",onClick:this.handleEllipsis,dangerouslySetInnerHTML:{__html:e}}))),React.createElement("span",{className:"annotation-item-preamble"},this.state.preamble),React.createElement("span",{className:"link annotation-item-page",onClick:this.handleAnnotationClick},"Page ",this.state.pageNo)):this.props.annotation.attributes.text!==this.props.prevAnnotation.attributes.text?React.createElement("div",{className:t,id:this.state.id},React.createElement("span",{className:"annotation-item-content"},a,React.createElement("nobr",null,React.createElement("a",{className:"annotation-item-ellipsis",href:"#",onClick:this.handleEllipsis,dangerouslySetInnerHTML:{__html:e}}))),React.createElement("span",{className:"annotation-item-preamble"},this.state.preamble),React.createElement("span",{className:"link annotation-item-page",onClick:this.handleAnnotationClick},"Page ",this.state.pageNo)):React.createElement("span",{id:this.state.id,className:"link annotation-item-page",onClick:this.handleAnnotationClick},", ",this.state.pageNo)}}),AnnotationsSort=React.createClass({displayName:"AnnotationsSort",getInitialState:function(){return{show:!1,sortBy:"cluster"}},componentDidMount:function(){var t=this;this.props.annotationsCollection.on("reset",function(){t.props.annotationsCollection.models.length>0&&t.setState({show:!0})}),this.setState({sortBy:"cluster"})},onClickPage:function(t){t.preventDefault(),this.props.annotationsCollection.setSortByKey("page_no"),this.props.contractApp.resetSelectedAnnotation(),this.props.contractApp.trigger("annotations:render"),this.setState({sortBy:"page_no"})},onClickTopic:function(t){t.preventDefault(),this.props.annotationsCollection.setSortByKey("category"),this.props.contractApp.resetSelectedAnnotation(),this.props.contractApp.trigger("annotations:render"),this.setState({sortBy:"cluster"})},render:function(){var t="",e="active",a="";"cluster"==this.state.sortBy&&(e="",a="active",t=React.createElement(AnnotationTopicList,{contractApp:this.props.contractApp}));this.state.sortBy;return this.state.show?React.createElement("div",{className:"annotation-sort"},React.createElement("span",{className:e,onClick:this.onClickPage
},lang.by_page),React.createElement("span",{className:a,onClick:this.onClickTopic},lang.by_topic),t):React.createElement("div",null)}}),AnnotationTopicList=React.createClass({displayName:"AnnotationTopicList",getInitialState:function(){return{show:!1}},handleClick:function(t){t.preventDefault(),this.props.contractApp.trigger("annotations:scroll-to-cluster",t.target.innerHTML),$(".annotations-topic-list > span").removeClass("selected-topic"),$(t.target).addClass("selected-topic")},render:function(){return React.createElement("div",{className:"annotations-topic-list"},React.createElement("span",{onClick:this.handleClick},lang.general),React.createElement("span",{onClick:this.handleClick},lang.environment),React.createElement("span",{onClick:this.handleClick},lang.fiscal),React.createElement("span",{onClick:this.handleClick},lang.operations),React.createElement("span",{onClick:this.handleClick},lang.social),React.createElement("span",{onClick:this.handleClick},lang.other))}}),AnnotationsList=React.createClass({displayName:"AnnotationsList",getInitialState:function(){return{message:lang.loading_annotations}},componentDidMount:function(){var t=this;this.props.annotationsCollection.on("reset",function(){t.props.annotationsCollection.models.length>0?t.setState({message:""}):t.setState({message:lang.no_annotation_msg}),t.props.contractApp.getSelectedAnnotation()&&t.props.contractApp.trigger("annotations:scroll-to-selected-annotation")}),this.props.contractApp.on("annotations:render",function(e){t.forceUpdate()}),this.props.contractApp.on("annotations:highlight",function(e){setTimeout(t.scrollToAnnotation(e.id),1e3)}),this.props.contractApp.on("annotations:scroll-to-selected-annotation",function(){t.scrollToAnnotation(t.props.contractApp.getSelectedAnnotation())}),this.props.contractApp.on("annotations:scroll-to-top",function(){t.scrollToTop()}),this.props.contractApp.on("annotations:scroll-to-cluster",function(e){t.scrollToCluster(e)})},scrollToCluster:function(t){if($("#"+t).offset()){var e=$("#"+t).offset().top,a=$(".annotation-inner-viewer").scrollTop(),n=$(".annotation-inner-viewer").offset().top;$(".annotation-inner-viewer").animate({scrollTop:a-n+e},200)}},scrollToAnnotation:function(t){if(t){var e=$("#"+t).offset().top,a=$(".annotation-inner-viewer").scrollTop(),n=$(".annotation-inner-viewer").offset().top;$(".annotation-inner-viewer").animate({scrollTop:a-n+e},200),this.props.contractApp.resetSelectedAnnotation()}},scrollToTop:function(t){t.preventDefault(),$(".annotation-inner-viewer").animate({scrollTop:0},500)},getAnnotationItemsComponent:function(t,e){var a=[];if(t.models.length>0)for(var n=0;n<t.models.length;n++)a.push(React.createElement(AnnotationItem,{showClusterAnyway:e,key:t.models[n].get("id"),contractApp:this.props.contractApp,prevAnnotation:t.models[n-1],annotation:t.models[n]}));return a},sortByPage:function(){return this.props.annotationsCollection.models.length>0?(this.props.annotationsCollection.sort(),React.createElement("div",{className:"annotations-list",id:"id-annotations-list"},this.getAnnotationItemsComponent(this.props.annotationsCollection,!0),React.createElement("div",{className:"annotations-list-footer"},React.createElement("a",{href:this.props.contractApp.getAnnotationsListAnchor()},lang.see_all_annotations)))):[]},sortByCluster:function(){var t=[],e=this;this.props.annotationsCollection.sort();var a=["General","Environment","Fiscal","Operations","Social","Other"];return _.map(a,function(a){var n=e.props.annotationsCollection.filter(function(t){return t.get("cluster")===a});if(n.length){var o=new AnnotationsCollection(n);t.push(React.createElement("div",{id:a,key:a},e.getAnnotationItemsComponent(o,!1)))}}),React.createElement("div",{className:"annotations-list",id:"id-annotations-list"},t)},render:function(){return this.props.annotationsCollection.models.length>0?"category"===this.props.annotationsCollection.sort_key?this.sortByCluster():this.sortByPage():React.createElement("div",{className:"annotations-list",id:"id-annotations-list"},this.state.message)}}),AnnotationsViewer=React.createClass({displayName:"AnnotationsViewer",getInitialState:function(){return{scrollBtnStyle:"display:none"}},handleGotoTop:function(t){t.preventDefault(),this.props.contractApp.trigger("annotations:scroll-to-top")},componentDidMount:function(){var t=150,e=200;$("#annotations-box").scroll(function(){$(this).scrollTop()>t?$(".back-to-top").fadeIn(e):$(".back-to-top").fadeOut(e)}),$(".back-to-top").click(function(t){return t.preventDefault(),$(".annotation-inner-viewer").animate({scrollTop:0},e),!1})},render:function(){return React.createElement("div",{className:"annotations-viewer",style:this.props.style},React.createElement("div",{className:"annotation-inner-viewer",id:"annotations-box"},React.createElement(AnnotationHeader,{contractApp:this.props.contractApp,annotationsCollection:this.props.annotationsCollection}),React.createElement(AnnotationsSort,{contractApp:this.props.contractApp,annotationsCollection:this.props.annotationsCollection}),React.createElement(AnnotationsList,{contractApp:this.props.contractApp,annotationsCollection:this.props.annotationsCollection})),React.createElement("a",{href:"#",className:"back-to-top btn btn-primary"},React.createElement("i",{className:"fa fa-arrow-up"})))}});